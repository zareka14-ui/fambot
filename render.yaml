version: 3
services:
  - type: worker  # Критически важно - Background Worker для бота
    name: fambot-worker
    env: python
    runtime: python
    pythonVersion: "3.11"
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
    startCommand: python main.py
    plan: free
    autoDeploy: true
    envVars:
      - key: BOT_TOKEN
        sync: false  # Секретный токен, будет вводиться вручную
      - key: PYTHONUNBUFFERED
        value: "true"
      - key: TZ
        value: "Europe/Izhevsk"
      - key: PYTHONPATH
        value: "/opt/render/project/src"
    numInstances: 1  # ОБЯЗАТЕЛЬНО 1 для избежания конфликтов
    disk:
      name: bot-storage
      mountPath: /data
      sizeGB: 1
    healthCheck:
      type: command
      command: python -c "import sys; sys.exit(0)"
      intervalSeconds: 60
      timeoutSeconds: 10
      maxFailures: 3
